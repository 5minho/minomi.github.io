---
layout: post
title: TDD 맛 보기
comments: true
tags:
- TDD
- Test
---

## 서론
---
저는 신입 iOS 개발자 입니다. 선배 개발자 분들이 항상 테스트를 강조하시고, TDD를 지금부터 연습해두면 좋다고 하시더군요. 저 같은 경우는 개발을 할때 Util 성격이 강한 클래스를 작성하고 테스트를 해보기 위해, 그리고 알고리즘 코딩 문제를 풀때 등등 이미 작성해 놓은 함수를 언어의 테스트 라이브러리를 이용해서 테스트는 해보고 있었지만 테스트를 먼저 작성한 후 개발을 하는 방식의 개발은 한 번도 해본적이 없는데요 이번에 TDD가 어떻게 진행되는 개발방식인지, 장단점이 무엇인지를 공부하고 정리하였습니다. (대다수의 내용은 TEST-DRIVEN IOS DEVELOPMENT WITH SWIFT라는 책 읽으면서 제가 공부한 내용 그리고 저의 의식 흐름??? 등을 정리했습니다.)

## 본론
---
Test driven development의 의미는 우리말로 더 정확하게 말하면 테스트 주도 개발이라는 뜻입니다. 처음 테스트 주도 개발이라는 말을 들었을때는 '그냥 테스트케이스를 엄청 많이 돌려서 여러가지 예외사항을 처리해 프로그램을 더 견고하게 만드는 것이구나.' 라고 생각했습니다. 물론 그런 의도가 어느정도 맞겠지만 단순히 테스트케이스를 많이 만드는 것이 아니고 TDD의 rules, 그리고 workflow 가 있었습니다.

#### Three Simple rules for TDD
* 실패 테스트가 통과하지 않으면 어떠한 프로덕션 코드를 작성할 수 없다.
* 컴파일이 실패하는 테스트는 작성할 수 없다.
* 하나의 실패 테스트가 통과하면 더 이상의 그 테스트에 대한 프로덕션 코드를 작성할 수 없다.

초기에 실패 유닛테스트를 만들어 놓고 그 유닛 테스트를 통과하면서 프로덕션 코드를 만들어 가는 느낌입니다.
그리고 그 유닛테스트를 통과하는 프로덕션 코드를 만들었다면, 더 이상 그 유닛테스트와 관련된 프로덕션 코드는 만들지 말라는 군요.
오직 너는 테스트를 통과하기 위해서만 프로덕션을 작성해라! 이렇게 말하는거 같습니다.
아직 살짝 감은 오는데 정확히 실패 유닛테스트가 무엇을 의미 하는지, 어떻게 작성해야 하는지 좀 이해가 안됩니다.
일단 이해가 안된 부분은 간단한 예제와 함께 TDD의 workflow를 공부하면서 천천히 이해해 봅니다.

문자열의 각 단어의 첫 글자를 대문자로 바꿔주는 기능 구현을 예로 workflow를 살펴보겠습니다.
저는 Xcode의 XCTest 그리고 Swift를 사용했습니다.

#### TDD workflow - red, green, and refactor
* ##### red
  red 단계에서는 구현되지 않은 소프트웨어의 필수 기능의 테스트를 작성합니다. 아직 프로덕션 코드르 작성하지 않았기 때문에 무조건 실패하게 되겠죠. 이 실패 테스트들은 후에 우리가 실패하지 않을때 까지 테스트해야 하는 코드들 입니다. 아직 통과되지 않아서 실패 테스트 (failing test) 라고 하는거 같네요.
![스크린샷 2018-04-02 오후 9.34.31](https://i.imgur.com/KzOa7O3.png)
  우리가 필요한 기능을 정의하고, 그에 필요한 테스트를 만들어 줍니다. 당연히 결과는 실패하게 놔둡니다.

* ##### green
   green 단계에서는 red 단계에서 작성한 실패 테스트들을 통과하는 코드를 작성하는 단계 입니다.
   아직 보기 좋은 코드를 짤 필요는 없고 그저 테스트들을 통과하게끔 가장 심플한 코드를 작성하면 됩니다. 이 단계에서 또 다른 실패 테스트가 필요할 수도 있습니다.

   ![스크린샷 2018-04-02 오후 9.36.55](https://i.imgur.com/CPw9Dpn.png)

  음... 테스트의 정의대로 테스트를 통과하는 가장 심플한 코드를 작성했습니다. 지금 작성한 코드는 위에 작성한 테스트만 통과하게 됩니다. 또 다른 테스트가 필요할 거 같군요.

* ##### refactor
  green 단계에서 작성한 프로덕션 코드를 리팩토링 하는 단계입니다. 중복코드를 제거하고 필요없는 변수들을 제거 합니다. 만약 테스트들이 없었다면 리팩토링 하는 과정에서 이미 구현해 놓은 기능에서 버그가 발생할 수 있겠지만, 우리가 이미 작성한 테스트들 때문에 또 다른 버그가 발생할 확률을 확 줄여줍니다.
  이 예에서는 리팩토링 할 거리는... 음 잘 모르겠습니다. 테스트 코드만 조금 수정하겠습니다.
  ![스크린샷 2018-04-02 오후 9.51.20](https://i.imgur.com/cL3Ty7X.png)

* ##### red2
  이전의 코드는 특정한 문자열("test driven development")일 때만 정상적으로 결과를 내는 코드입니다.
  당연히 이런 결과는 제가 바라는 결과가 아니므로 또 다른 실패 테스트를 작성하겠습니다.
  ![스크린샷 2018-04-02 오후 9.57.28](https://i.imgur.com/nuJqkW9.png)
  당연히 결과는 실패겠죠

* ##### green2
  red2 단계를 통과하기 위해 이미 통과한 테스트를 다시 실패시키면 안되겠죠.
![스크린샷 2018-04-02 오후 10.11.38](https://i.imgur.com/yGEAtVW.png)
테스트를 통과시키는 코드를 작성합니다.

* ##### refactor2
  위의 코드는 일단 테스트는 통과를 했지만 깔끔해 보이지는 않는데요. 특히 마지막에 공백을 지우려고 remove 함수를 호출하는 부분이 마음에 안드네요. Swift에는 코드의 가독성을 높혀주고 간결하게 표현할 수 있는 다양한 api가 있습니다.
  ![스크린샷 2018-04-02 오후 10.23.00](https://i.imgur.com/cGm0P8f.png)
  joined 함수를 사용하면 마지막 공백을 삭제하기 위해 별도로 remove 함수를 사용하지 않아도 됩니다.

## 결론
---
TDD가 뭔지 감을 잡아 보기 위해 이 포스트를 작성해봤는데요. 일단 제가 공부한 책에서 설명하는 TDD의 장/단점을 정리해봤습니다.

장점입니다.
* 오직 필요한 코드만 작성하게 된다.
* 좀 더 모듈화된 코드를 작성하게 된다
* 유지보수하기 용이해진다
* 리팩토링하기 쉬워진다
* 높은 test coverage
* 테스트들이 코드를 설명해준다
* 적은 디버깅

단점입니다.
* 테스트들이 버그를 발견하는데 도움은 주지만, 버그를 찾아주지는 않는다.
* 초보자들에겐 너무 느린 개발방식
* 팀원 모두가 TDD를 해야함
* 요구사항이 변화함에 따라 테스트도 따라서 변경시켜줘야함

TDD를 소개하는 책이라서 그런지 장점이 우월하게 많네요. 그래도 위의 예제를 작성하면서 저 장점들에 대해 이해가 갔습니다. red -> green -> refactor 이 단계를 반복하면서 예제를 작성해 갔는데, 각 단계 마다 확실한 목표가 있었고 그 목표를 잘 달성하기만 하면 내가 원하는 기능이 안전하고, 군더더기 없는 깔끔한 코드로 구현되었기 때문에 확실히 TDD라는 개발방식은 연습해두면 좋을거라는 확신이 들었습니다.
